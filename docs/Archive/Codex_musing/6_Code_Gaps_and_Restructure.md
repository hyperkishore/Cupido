# Code Gaps and Restructure Plan

| Issue | Evidence | Recommended Change |
| --- | --- | --- |
| Monolithic reflection component | `ChatReflectionInterface` exceeds 900 lines and mixes UI, audio, AI heuristics, storage, and analytics in one file (`src/components/ChatReflectionInterface.tsx:1`). | Split into hook modules (recording/transcription, question selection, response handling) and a presentational component; back each module with tests. |
| Duplicate service implementations | Legacy `.js` services sit alongside TypeScript versions (`src/services/matching.service.js`, `src/services/supabase.service.js`, `src/services/questionsService.ts`) creating drift risk. | Consolidate on the TypeScript files, delete or archive the JS copies, and expose services through an index barrel for dependency inversion. |
| Root cluttered with historical App shells | Multiple `App.*.tsx` variants remain even though the project only builds from `App.tsx` (`App.simple.tsx:1`, `App.full.tsx`, `App.updated.tsx`). | Move unused shells into `/archive/App/` or delete them after verifying git history, keeping the entry point obvious. |
| Hard-coded seed data scattered across contexts/services | Initial reflections, community feed, habit data, and personality traits are embedded in code (`src/contexts/AppStateContext.tsx:41`, `src/services/communityService.ts:58`, `src/services/personalityInsightsService.ts:46`). | Centralize demo seeds in JSON fixtures, load them through a seed helper, and replace them with real fetches in production mode. |
| Conflicting question loaders | Both `questionLoader` and `questionsLoader` read the same JSON with slight variations (`src/services/questionLoader.ts:1`, `src/services/questionsLoader.ts:1`). | Merge into a single typed question repository and expose consistent helpers for demo vs. production. |
| No automated tests or CI hooks | The repo ships without unit or integration tests for services or screens. | Introduce Jest/Vitest coverage for services (conversation memory, matching) and snapshot tests for PixelPerfect screens before onboarding backend work. |
| Feedback wrapper overrides every `onPress` prop | The feedback system re-clones children to insert handlers and highlight styles (`src/components/FeedbackSystem.tsx:120`), which risks masking genuine press events. | Refactor to use React portals or gestures that decorate components without mutating their props, ensuring production interactions remain pristine. |
| Configuration sprawl | API endpoints, feature flags, and demo constants are sprinkled across multiple files (`src/config/api.config.ts:3`, `src/config/demo.ts:1`). | Create a unified configuration module that pulls from environment variables and provides typed feature flags. |
